var Jarvis=function(e,t){"use strict";var n,r;r={createElement:function(e,t,n){var r=document.createElement(e);if(t)for(var i in t)r.setAttribute(i,t[i]);if(n)r.innerHTML=n;return r},inputInFocus:function(e){return/INPUT|SELECT|TEXTAREA/.test(e.target.tagName)||e.target.contentEditable==="true"},isJarvisXhr:function(e,t,n){return/action=jarvis-search/.test(n.url)},getComputedStyle:function(t){return e.getComputedStyle?e.getComputedStyle(t,false):t.currentStyle},trim:function(e){return String.prototype.trim?e.trim():e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}};n=function(e){var n=this;this.settings={hotkey:191,separator:"Â»",loadingimg:"/wp-content/plugins/wp-jarvis/img/wpspin.gif"};t.extend(this.settings,e);this.localData=[];this.modal=r.createElement("div",{id:"jarvis-modal"});this.search=r.createElement("input",{type:"text",id:"jarvis-search"});this.overlay=r.createElement("div",{id:"jarvis-overlay"});this.loading=r.createElement("img",{src:this.settings.loadingimg,id:"jarvis-loading"});t(this.overlay).on("click",function(e){n.close(e)});this.icons={};if(/complete|loaded/.test(document.readyState)){this.init()}else{t(function(e){n.init.call(n,e)})}};n.prototype={close:function(e){this.opened=false;this.overlay.parentNode.removeChild(this.overlay);this.modal.parentNode.removeChild(this.modal);t(this.search).typeahead("destroy")},init:function(){var n=this,i,s,o,u,a,f;t("#adminmenu a").each(function(e,i){var s,o,u,a,l,c;l=function(e){return t(e).clone().find("span").remove().end().text()};o=t(this).closest(".menu-top");s=l(o.find("a > .wp-menu-name"));u=l(this);c=function(){var e=o.find(".wp-menu-image")[0],n=o.find(".wp-menu-image img")[0],i,s;if(e&&e.className.indexOf("dashicons-before")>-1){s=e.className.split(" ");s.splice(t.inArray("wp-menu-image",s),1);s.splice(t.inArray("dashicons-before",s),1);return{type:"dashicon",icon:s[0]}}else if(n){return{type:"image",icon:"background-image:url("+n.src+");background-position:center"}}else if(e){i=r.getComputedStyle(e);if(typeof i.backgroundPosition==="string"){return{type:"image",icon:"background-image:"+i.backgroundImage+";background-position:"+i.backgroundPosition}}else{return{type:"image",icon:"background-image:"+i.backgroundImage+";background-position-x:"+i.backgroundPositionX+";background-position-y:"+i.backgroundPositionY}}}else{return null}}();n.icons[s.toLowerCase()]=c;switch(true){case s==="":case s===u:a=u;break;default:a=s+" "+n.settings.separator+" "+u}f={id:this.id||null,kind:"href",href:this.href,prefix:r.trim(s).toLowerCase(),title:r.trim(a),type:"menu"};if(c){f.icontype=c.type;switch(c.type){case"dashicon":f.iconclass="dashicons-before "+c.icon;f.image="";break;case"image":f.iconclass="image-icon";f.image=c.icon;break}}n.localData.push(f)});a={attachment:{"image-icon":"media",dashicon:"dashicons-admin-media"},category:{"image-icon":"posts",dashicon:"dashicons-category"},nav_menu:{"image-icon":"appearance",dashicon:"dashicons-admin-appearance"},nav_menu_item:{"image-icon":"appearance",dashicon:"dashicons-admin-appearance"},page:{"image-icon":"pages",dashicon:"dashicons-admin-page"},post:{"image-icon":"posts",dashicon:"dashicons-admin-post"},post_tag:{"image-icon":"posts",dashicon:"dashicons-tag"},post_format:{"image-icon":"posts",dashicon:"dashicons-format-standard"},term:{"image-icon":"posts",dashicon:"dashicons-category"}};for(var l in a){if(a.hasOwnProperty(l)){n.icons[l]=n.settings.dashicons?a[l]:n.icons[a[l]["image-icon"]]}}if(document.addEventListener){document.addEventListener("keydown",function(e){if(e.keyCode===n.settings.hotkey&&!r.inputInFocus(e)){e.preventDefault();e.stopPropagation()}},true)}t(document).on("keyup",function(){n.keystroke.apply(n,arguments)});t(e).on("resize",function(){if(n.opened){n.resize.apply(n,arguments)}});t(document).ajaxSend(function(e,t,i){if(n.opened&&r.isJarvisXhr.apply(this,arguments)){n.modal.appendChild(n.loading)}});t(document).ajaxComplete(function(e,t,i){if(n.opened&&r.isJarvisXhr.apply(this,arguments)){n.loading.parentNode.removeChild(n.loading)}})},keystroke:function(e){e.preventDefault();e.stopPropagation();switch(true){case this.opened&&e.keyCode===27:this.close();break;case r.inputInFocus(e):return;case!this.opened&&e.keyCode===this.settings.hotkey:this.open();break}},go:function(e,t,n){location.href=t.href},open:function(e){var n=this;if(e&&e.preventDefault)e.preventDefault();this.opened=true;this.modal.appendChild(this.search);document.body.appendChild(this.overlay);document.body.appendChild(this.modal);this.modal.style.marginLeft=Math.max(-1*this.modal.offsetWidth/2)+"px";t(this.search).typeahead([{engine:Hogan,name:"local",limit:5,local:n.localData,template:['<span class="{{prefix}} {{kind}}">','<a href="{{href}}">','<span class="jarvis-icon {{iconclass}}" style="{{image}}" title="{{prefix}}"></span>','<span class="jarvis-title" title="{{{title}}}">{{{title}}}</span>',"</a>","</span>"].join(""),valueKey:"title"},{engine:Hogan,name:"remote",limit:20,remote:{cache:false,dataType:"json",filter:function(e){for(var t=0;t<e.length;t++){e[t].icon=n.icons[e[t].type];e[t].iconclass=n.settings.dashicons?"dashicons-before "+e[t].icon.dashicon:"image-icon";e[t].image=e[t].icon.icon}return e},maxParallelRequests:10,url:ajaxurl+"?action=jarvis-search&q=%QUERY"},template:['<span class="{{kind}}">','<a href="{{href}}">','{{#att_src}}<span class="jarvis-thumbnail"><img src="{{att_src}}"></span>{{/att_src}}','<span class="jarvis-icon {{iconclass}}" style="{{image}}" title="{{type}}"></span>','<span class="jarvis-title" title="{{{title}}}">{{{title}}}</span>',"</a>","</span>"].join(""),valueKey:"title"}]).typeahead("setQuery","").on("typeahead:selected",function(){n.go.apply(n,arguments)});this.search.focus()},resize:function(){this.modal.style.marginLeft=Math.max(-1*this.modal.offsetWidth/2)+"px"}};return n}(this,jQuery)